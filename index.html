<!DOCTYPE html>
<html lang="cs">    
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>martinWeiss | 8PUZZLE</title>
        <meta name="author" content="Martin Weiss (martinWeiss.cz)">
        <meta name="description" content="8PUZZLE Project">
        <link rel="stylesheet" href="app.css" media="none" onload="if(media!='all')media='all'"><noscript><link rel="stylesheet" href="app.css"></noscript>
        <script defer src="app.js"></script>
    </head>
    
    <body>
        <div id="root">
            <nav>
                <svg class="logo" viewBox="0 0 147 52.9"><g class="fp"><path d="M24.8 35.9c-2.3.2-4.2-.4-5.9-1.7-1.7-1.3-2.6-3.1-2.8-5.3-.1-2.2.6-4 2.3-5.5-1.3-1.1-1.9-2.4-2.1-4.1-.1-1.9.5-3.6 1.8-4.9 1.3-1.3 2.9-2 4.9-2.1 2-.1 3.7.3 5.1 1.4 1.6 1.1 2.4 2.7 2.5 4.6.1 1.6-.4 3.1-1.4 4.3 1.8 1.1 2.8 2.8 3 5.1.2 2.3-.5 4.2-2.1 5.7-1.2 1.6-3 2.4-5.3 2.5zm-1.2-18c-.9.1-1.4.6-1.3 1.6.1 1 .6 1.5 1.5 1.4 1-.1 1.4-.6 1.4-1.6-.1-1-.7-1.5-1.6-1.4zm.5 7.9c-1.3.1-1.9.9-1.8 2.4.1.7.3 1.2.6 1.6.4.4.9.6 1.5.5.6 0 1-.3 1.4-.7.3-.5.5-1 .4-1.7 0-1.5-.7-2.2-2.1-2.1zM41.5 28.4l-2.5.5.7 4.1c0 .2.1.4.1.7 0 .9-.3 1.6-.9 2.1-.6.5-1.3.8-2.2.8-.7 0-1.3-.2-1.9-.7-.5-.5-.9-1.1-1-1.9l-2.9-16.6c0-.2-.1-.4-.1-.7 0-1.6.9-2.6 2.6-2.9l5.2-.9c.6-.1 1.2-.1 1.8-.1 2 0 3.8.6 5.2 1.7 1.4 1.2 2.4 2.7 2.7 4.7.1.5.1 1 .1 1.5 0 2-.6 3.7-1.9 5.1s-3 2.3-5 2.6zm-2.1-10.1l-2.3.4.8 4.8 2.3-.4c1.3-.2 1.9-1 1.9-2.3 0-.7-.2-1.3-.6-1.8-.4-.5-1-.8-1.7-.8 0 .1-.2.1-.4.1z"/><path d="M55.5 35.8c-2.4-.4-4.4-1.5-6-3.2-1.6-1.8-2.4-3.8-2.4-6.2 0-.5 0-1 .1-1.6L49 14.2c.1-.8.4-1.5 1-1.9.5-.5 1.2-.7 1.9-.7.9 0 1.6.3 2.2.8.6.5.9 1.3.9 2.1 0 .2 0 .4-.1.6l-1.6 10.4c0 .3-.1.6-.1.9 0 1.1.4 2.1 1.1 2.8.7.8 1.6 1.1 2.7 1.1 1 0 1.8-.3 2.5-1s1.2-1.5 1.3-2.6l1.6-10.3c.1-.8.5-1.5 1-2s1.2-.7 1.9-.7c.9 0 1.6.3 2.2.8.6.6.9 1.3.9 2.1v.6l-1.7 10.6c-.4 2.4-1.5 4.3-3.3 5.8-1.8 1.5-3.9 2.2-6.3 2.2-.5.1-1 .1-1.6 0z"/><path d="M84.7 34.8L73 36.2c-.2 0-.4.1-.5.1-.8 0-1.5-.2-2.1-.7-.6-.5-.9-1.1-1-1.9-.1-.7 0-1.5.5-2.3l7.3-13.3-6.5.9c-.8.1-1.5 0-2-.4-.6-.4-1-1-1.1-1.9-.1-.8.1-1.5.6-2.1.5-.6 1.1-1 1.9-1L81 12.2h.5c.9 0 1.6.2 2.1.7s.8 1.1.9 1.8c.1.8-.1 1.6-.5 2.4l-7.2 13.1 7.2-.9c.8-.1 1.5 0 2.1.4.6.4 1 1.1 1.1 1.9.1.8-.1 1.5-.6 2.1-.6.7-1.2 1-1.9 1.1z"/><path d="M101.6 34.8l-11.7 1.4c-.2 0-.4.1-.5.1-.8 0-1.5-.2-2.1-.7-.6-.5-.9-1.1-1-1.9-.1-.7 0-1.5.5-2.3L94 18.2l-6.4.8c-.8.1-1.5 0-2-.4-.6-.4-1-1-1.1-1.9-.1-.8.1-1.5.6-2.1.5-.6 1.1-1 1.9-1l10.9-1.4h.5c.9 0 1.6.2 2.1.7s.8 1.1.9 1.8c.1.8-.1 1.6-.5 2.4l-7.2 13.1 7.2-.9c.8-.1 1.5 0 2.1.4.6.4 1 1.1 1.1 1.9.1.8-.1 1.5-.6 2.1-.6.7-1.2 1-1.9 1.1z"/><path d="M113.1 35.9l-7.5-.7c-.9-.1-1.7-.4-2.2-1.1-.5-.6-.7-1.4-.6-2.4l1.4-16.7c.1-.9.4-1.6 1.1-2.1.6-.5 1.4-.7 2.2-.6.9.1 1.5.4 2.1 1 .5.6.7 1.4.7 2.3L109 29.9l4.6.4c.9.1 1.5.4 2 .9s.7 1.1.7 1.8c0 .8-.3 1.5-.8 2.1-.6.6-1.4.9-2.4.8z"/><path d="M125.8 36.2l-7.6-1.5c-.7-.1-1.3-.5-1.8-1s-.7-1.2-.7-1.9c0-.2 0-.4.1-.6L119 15c.4-1.8 1.3-2.8 2.9-2.8.2 0 .5 0 .7.1l7.3 1.4c.8.2 1.4.5 1.8 1 .4.5.6 1.1.6 1.8 0 .8-.3 1.5-.8 2-.5.6-1.2.8-2 .8-.2 0-.4 0-.6-.1l-4.5-.9-.5 2.8 4.1.8c.8.2 1.4.5 1.8 1 .4.5.6 1.1.6 1.8 0 .8-.3 1.5-.8 2-.6.6-1.2.8-2 .8-.2 0-.4 0-.6-.1l-4.1-.8-.6 3 4.7.9c.8.1 1.3.5 1.7 1s.6 1.1.6 1.8c0 .8-.3 1.5-.8 2-.5.6-1.2.8-2 .8-.3.1-.5.1-.7.1z"/></g><g class="bp"><path d="M75.3 39.4h-.2c-.2 0-.4-.1-.6-.2-.2-.2-.3-.4-.4-.6l-.6-2.4c-.1-.4-.3-.6-.6-.6-.2 0-.3.1-.4.2-.1.1-.2.3-.2.4v.3l.6 2.4v.3c0 .2-.1.4-.2.6-.1.2-.3.3-.5.3H72c-.2 0-.4-.1-.6-.2-.2-.2-.3-.4-.4-.6l-.6-2.4c-.1-.4-.3-.6-.6-.6-.4 0-.6.2-.6.6v.3l.6 2.5v.3c0 .2-.1.4-.2.6-.1.2-.3.3-.5.3h-.2c-.2 0-.4-.1-.6-.2-.2-.3-.3-.5-.3-.7l-.9-3.7V36c0-.2.1-.4.2-.6.1-.2.3-.3.5-.3h.3c.2 0 .4.1.6.2.4-.5.9-.8 1.6-.8.4 0 .8.1 1.1.3.4-.5.8-.8 1.3-.9.2 0 .4-.1.6-.1.5 0 .9.1 1.3.4.4.3.6.7.7 1.3l.6 2.7v.3c0 .2-.1.4-.2.6 0 .1-.2.2-.4.3z"/><path d="M81 39.7h-.3c-.2 0-.4-.1-.6-.3-.3.4-.7.6-1.1.8-.2 0-.4.1-.6.1-.6 0-1.2-.2-1.7-.7-.5-.4-.8-1-1-1.8-.1-.3-.1-.5-.1-.8 0-.7.2-1.3.5-1.8.4-.5.8-.8 1.4-1 .2 0 .3-.1.5-.1.3 0 .6.1.9.2.1-.3.3-.5.7-.6h.3c.4 0 .7.3.9 1l.8 3.5c0 .2.1.4.1.5 0 .6-.2.9-.7 1zM77.6 37v.4c.1.3.2.5.4.7.2.2.4.3.6.3.3 0 .5-.1.6-.3.1-.2.2-.4.2-.7V37c-.1-.3-.2-.5-.4-.7-.2-.2-.4-.3-.6-.3-.3 0-.5.1-.6.3-.1.2-.2.4-.2.7z"/><path d="M83.7 34.6c.2-.2.5-.3.9-.3.3 0 .5.1.6.3.2.2.3.5.2.8 0 .3-.2.5-.5.7l-.9.3c-.3.1-.5.3-.5.6l-.1 2.2c0 .3-.1.5-.3.7s-.4.3-.7.3c-.3 0-.5-.1-.7-.3-.2-.2-.2-.5-.2-.8l.3-3.9c0-.3.2-.5.4-.7.2-.1.4-.2.7-.2.4-.1.7 0 .8.3z"/><path d="M88 36.3h-.2l-.7 3c-.1.3-.2.5-.3.6-.2.1-.4.2-.6.2H86c-.2-.1-.4-.2-.5-.3-.1-.2-.2-.4-.2-.6v-.3l.7-3h-.1c-.5-.1-.7-.4-.7-.8v-.2c0-.2.1-.4.3-.5.2-.1.3-.2.5-.2H86.3l.1-.6.3-.6c.1-.2.4-.2.6-.2h.2c.2.1.4.2.5.3.1.2.2.4.2.6v.3l-.1.6h.2c.5.1.7.4.7.8v.2c-.1.5-.4.7-.8.7H88zM90.1 34.2c-.3 0-.5-.1-.8-.3-.2-.2-.3-.5-.4-.7 0-.3.1-.5.3-.7.2-.2.4-.3.7-.4.3 0 .5.1.8.3.2.2.3.4.4.7 0 .3-.1.6-.3.8-.1.2-.4.3-.7.3zm.3 6c-.3 0-.5-.1-.7-.3-.2-.2-.3-.4-.3-.7l-.2-3.8c0-.3.1-.6.2-.8.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7l.2 3.8c0 .3-.1.6-.2.8-.2.1-.4.2-.7.3zM95.2 40.5c-.2-.1-.4-.2-.5-.3-.1-.2-.2-.4-.2-.6v-.3l.6-2.4v-.3c0-.2-.1-.4-.2-.5-.1-.1-.3-.2-.5-.2-.3 0-.5.2-.6.6l-.6 2.4c-.1.2-.2.4-.4.6-.2.2-.4.2-.6.2H92c-.2-.1-.4-.2-.5-.3-.1-.2-.2-.4-.2-.6v-.3l.9-3.7c.1-.3.2-.5.3-.6.2-.2.4-.2.6-.2.4 0 .7.2.9.5.2-.1.5-.2.8-.2.2 0 .4 0 .6.1.5.1.9.4 1.3.7.3.4.5.8.5 1.3 0 .2 0 .4-.1.6l-.6 2.7c-.1.3-.2.5-.3.6-.2.1-.4.2-.6.2h-.4zM103.6 37.2c.2-.7.6-1.8 1.3-3.3.2-.5.5-.7 1-.7h.3c.2 0 .4.2.6.3.1.2.2.4.2.6v.2c0 .1-.1.3-.1.4l-2.3 5.1c-.2.5-.6.8-1.1.8h-.3c-.3-.1-.5-.2-.7-.4-.2-.2-.3-.5-.3-.7l-.3-3.4-1.5 3c-.2.5-.6.7-1.1.7H99c-.3-.1-.6-.2-.8-.5-.2-.2-.3-.5-.3-.7l-.2-5.6v-.4c0-.2.1-.4.3-.5s.4-.2.6-.2h.2c.6.1.8.5.9 1.1v3.5c.3-.7.9-1.8 1.7-3.3.2-.4.5-.6.9-.6.3 0 .5.1.7.3.2.2.3.4.3.7l.3 3.6z"/><path d="M110.9 37.2l-2.6.9c.2.2.4.3.7.3.2 0 .3 0 .5-.1s.5-.3.7-.6c.3-.2.5-.4.7-.5h.1c.2 0 .4.1.6.3.2.2.3.4.3.6 0 .4-.2.8-.7 1.2-.4.4-.9.7-1.3.8-.3.1-.7.2-1 .2-.6 0-1.2-.2-1.7-.6s-.8-.9-1.1-1.5c-.1-.3-.2-.7-.2-1.1 0-.6.2-1.2.5-1.7s.8-.9 1.4-1.1c.3-.1.6-.2.9-.2.6 0 1.2.2 1.7.6.5.4.8.8 1 1.3 0 .1.1.3.1.4 0 .5-.2.7-.6.8zm-2.5-1.3c-.4.1-.6.4-.6.8l1.6-.5c-.2-.2-.4-.3-.7-.3h-.3zM112.7 34.2c-.3 0-.5-.1-.8-.3-.2-.2-.3-.5-.4-.7 0-.3.1-.5.3-.7.2-.2.4-.3.7-.4.3 0 .5.1.8.3.2.2.3.4.4.7 0 .3-.1.6-.3.8-.2.2-.4.3-.7.3zm.3 6c-.3 0-.5-.1-.7-.3-.2-.2-.3-.4-.3-.7l-.2-3.8c0-.3.1-.6.2-.8.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7l.2 3.8c0 .3-.1.6-.2.8-.2.1-.4.2-.7.3z"/><path d="M116.8 40.2c-.2 0-.4.1-.7.1-.4 0-.8-.1-1.1-.2-.5-.2-.7-.5-.7-.8 0-.2 0-.4.1-.5.1-.2.3-.3.5-.4h.3c.1 0 .3 0 .5.1s.4.1.5.1h.2c.2 0 .3-.1.3-.2s-.2-.1-.7-.2c-.6-.1-1-.2-1.3-.3-.5-.2-.8-.6-.9-1.1 0-.2-.1-.3-.1-.5 0-.6.3-1.1.8-1.5.5-.3 1-.5 1.6-.5.4 0 .8.1 1.1.2.4.2.6.5.6.8 0 .2-.1.4-.2.6-.2.2-.3.3-.6.3-.1 0-.3 0-.5-.1s-.4-.1-.5-.1c-.2 0-.3 0-.3.1 0 0-.1.1 0 .1s.3.1.7.2c.6.1 1 .2 1.3.3.5.2.8.6.9 1.1v.4c0 .5-.2.9-.5 1.2-.3.4-.7.6-1.3.8z"/><path d="M121.1 40.2c-.2 0-.4.1-.7.1-.4 0-.8-.1-1.1-.2-.5-.2-.7-.5-.7-.8 0-.2 0-.4.1-.5.1-.2.3-.3.5-.4h.3c.1 0 .3 0 .5.1s.4.1.5.1h.2c.2 0 .3-.1.3-.2s-.2-.1-.7-.2c-.6-.1-1-.2-1.3-.3-.5-.2-.8-.6-.9-1.1 0-.2-.1-.3-.1-.5 0-.6.3-1.1.8-1.5.5-.3 1-.5 1.6-.5.4 0 .8.1 1.1.2.4.2.6.5.6.8 0 .2-.1.4-.2.6-.2.2-.3.3-.6.3-.1 0-.3 0-.5-.1s-.4-.1-.5-.1c-.2 0-.3 0-.3.1 0 0-.1.1 0 .1s.3.1.7.2c.6.1 1 .2 1.3.3.5.2.8.6.9 1.1v.4c0 .5-.2.9-.5 1.2-.3.4-.7.6-1.3.8zM122.8 39.2c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7-.2.2-.4.3-.7.3-.3 0-.5-.1-.7-.3-.2-.2-.3-.4-.3-.7zM127.7 40.2c-.8 0-1.5-.2-2.1-.8-.5-.6-.8-1.2-.9-2.1 0-.8.2-1.5.7-2.2.5-.6 1.2-1 2-1 .4 0 .9 0 1.3.2.5.2.8.5.8.8 0 .2 0 .4-.2.6-.1.2-.3.4-.6.4-.1 0-.3 0-.6-.1s-.4-.1-.6-.1c-.3 0-.5.1-.7.4-.2.2-.2.5-.2.9 0 .3.1.6.3.8.2.2.4.3.7.3.1 0 .3-.1.5-.2s.4-.2.5-.2c.2 0 .4.1.6.2.2.2.3.4.3.6 0 .4-.2.7-.7 1-.3.4-.7.5-1.1.5z"/><path d="M133.2 40.4l-3.3-.8c-.4-.1-.7-.3-.7-.7 0-.3.1-.5.3-.7l2.5-2.3-1.2-.3c-.2-.1-.4-.2-.5-.3-.1-.2-.2-.3-.2-.5v-.2c.1-.5.4-.7.8-.7h.2l3.2.7c.4.1.6.3.6.7v.2c0 .2-.2.4-.3.5l-2.6 2.3 1.4.3c.2 0 .4.1.5.3s.2.3.2.5v.2c-.1.5-.4.7-.9.7.2.1.1.1 0 .1z"/></g></svg>
            </nav>
            <div id="config">
                <input type="number" id="puzzle-in" placeholder="Vstup">
                <button id="fillpuzzle">Fill w/ input</button>
                <input type="number" id="puzzle-out" placeholder="Výstup">
                <button id="calculatepuzzle">Calculate</button>
            </div>
            <main>
                <div id="puzzle-container">
                    <div id="t1" class="puzzle-item"></div>
                    <div id="t2" class="puzzle-item"></div>
                    <div id="t3" class="puzzle-item"></div>
                    <div id="t4" class="puzzle-item"></div>
                    <div id="t5" class="puzzle-item"></div>
                    <div id="t6" class="puzzle-item"></div>
                    <div id="t7" class="puzzle-item"></div>
                    <div id="t8" class="puzzle-item"></div>
                    <div id="t9" class="puzzle-item"></div>
                </div>                
            </main>
            <div id="steps">step</div>
        </div>
    </body>

    <script>
        const inputIn = document.getElementById("puzzle-in"),
                inputOut = document.getElementById("puzzle-out");

        document.getElementById("fillpuzzle").addEventListener("click", (e) => {
            let input = inputIn.value;
            if(input.includes(0)) {
                input = input.split("");
                console.info(input);
                
                if(input.length == 9) {
                    let children = document.getElementById("puzzle-container");
                    for(let i = 0; i < children.childElementCount; i++) {
                        children.children[i].innerText = "";
                        children.children[i].classList.remove("empty");

                        if(input[i] === "0") {
                            children.children[i].classList.add("empty");

                        } else children.children[i].innerText = input[i];
                    }
                } else {
                    console.warn("Musí být 9 prvků")
                }
            } else console.warn("Neobsahuje nulovou pozici");
        })

    /* ----------------------------------------------------------- */
    function printTableArray(arr, columns = 3) {
        console.log("-------------");
        for(let i = 0; i < arr.length; i++) {
            let row = "|";
            for(let j = 0; j < columns; j++) row += ` ${arr[i][j]} |`;
            console.log(row);
        }
    }

    const keywords = ["LEFT", "UP", "RIGHT", "DOWN"];
    document.addEventListener("keydown", e => {
        if(!set) return;
        if(keywords[e.keyCode - 37] === undefined) return;
        startNode = move(startNode, keywords[e.keyCode - 37]);
        //console.table(startNode);
        printTableArray(startNode);
        if(compareArrays(startNode, expectedNode)) {
            set = false;
            console.log("YOU WON!");
        }
    });

    let set = false, startNode, expectedNode;
    /* ----------------------------------------------------------- */

    function calculatePuzzle(initialState = "134025678", finalState = "123456780") {
        if(!(initialState.includes(0)) || !(finalState.includes(0))) return console.warn(`[!] initialState & finalState requires 0`);
        if((initialState.length !== 9) || (finalState.length !== 9)) return console.warn(`[!] initialState & finalState have to have length 9 nums`);
        startNode = fetchMatrix(initialState.split("").map(i => parseInt(i)), 3),
        expectedNode = fetchMatrix(finalState.split("").map(i => parseInt(i)), 3);
        set = true;
    }
    
    function move(array, direction) {
        let x, y, nullpos = getNullPosition(array);
        x = nullpos[0], y = nullpos[1];

        switch(direction) {
            case "UP":
            case "DOWN":
                if(array[y+(dirs[direction][0])] === undefined) {console.info("Tudy ti pšenka nepokvete"); return array;}
                break;
            case "RIGHT":
            case "LEFT":
                if(array[y+(dirs[direction][0])][x+(dirs[direction][1])] === undefined) {console.info("Tudy ti pšenka nepokvete"); return array;}
                break;
        }
        
        array[y][x] = array[y+(dirs[direction][0])][x+(dirs[direction][1])];
        array[y+(dirs[direction][0])][x+(dirs[direction][1])] = 0;
        return array;
    }

    function getNullPosition(array) {
        let x, y;
        for(let i = 0; i < array.length; i++) {
            for(let j = 0; j < array[i].length; j++) {
                if(array[i][j] === 0) {
                    x = j;
                    y = i;
                    break;
                }
            }
        }
        return [x, y];
    }

    /* =================================================== */
    let closedpaths = [];

    class Node {
        constructor(currentnode, parentnode, g, h, direction) {
            this.currentnode = currentnode;
            this.parentnode = parentnode;
            this.g = g;
            this.h = h;
            this.f = g+h;
            this.direction = direction;
        }
    }

    const dirs = {"UP": [-1, 0], "DOWN": [1, 0], "RIGHT": [0, 1], "LEFT": [0, -1]};
    function findDirectionWithLowestH(node, goal) {
        let indexOfLowest, subnodes = [];

        for(let i = 0; i < Object.keys(dirs).length; i++) {
            let temp = getMovedNode(node, Object.keys(dirs)[i]);
            //console.log(JSON.stringify(temp));
            if(!(JSON.stringify(closedpaths).includes(JSON.stringify(temp)))) subnodes.push(temp);
        }

        const subnodesHs = subnodes.map(ln => calcMisplaced(ln, goal));
        indexOfLowest = subnodesHs.indexOf(Math.min.apply(Math, subnodesHs));
        return {"steps": subnodesHs[indexOfLowest], "node": subnodes[indexOfLowest]};
    }

    function getMovedNode(node, direction) {
        let x, y, nullpos = getNullPosition(node);
        x = nullpos[0], y = nullpos[1];

        switch(direction) {
            case "UP":
            case "DOWN":
                if(node[y+(dirs[direction][0])] === undefined) return 0;
                break;
            case "RIGHT":
            case "LEFT":
                if(node[y+(dirs[direction][0])][x+(dirs[direction][1])] === undefined) return 0;
                break;
            default:
                return 0;
                break;
        }
        node[y][x] = node[y+(dirs[direction][0])][x+(dirs[direction][1])];
        node[y+(dirs[direction][0])][x+(dirs[direction][1])] = 0;
        return node;
    }

    /* =================================================== */
    /* Compare two nodes */
    function compareNodes(arr1, arr2) {
        return (JSON.stringify(arr1) === JSON.stringify(arr2));
    }
    
    /* Calculate node H value (count of misplaced tiles) */
    function calcMisplaced(node, goal) {
        let h = 0;
        for(let i = 0; i < node.length; i++) {
            for(let j = 0; j < node[i].length; j++) {
                if(node[i][j] !== 0 && (node[i][j] !== goal[i][j])) h++;
            }
        }
        return h;
    }

    /* Parse input into the Matrix */
    function fetchMatrix(array, columns = 3) {
        let nextrow = false, comrow = [], final = [];

        for(let i = 0; i < array.length; i++) {
            if(nextrow) {
                nextrow = false;
                final.push(comrow);
                comrow = [];
            }

            if((i+1)%columns === 0) nextrow = true;
            comrow.push(array[i]);
        }
        final.push(comrow);
        return final;
    }
    </script>
</html>